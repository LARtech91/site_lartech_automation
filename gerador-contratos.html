<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerador de Contratos - LARtech Automation</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #00A6FB 0%, #0582CA 100%);
      color: white;
      padding: 30px;
      position: relative;
      overflow: hidden;
    }

    .header-content {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 30px;
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
      z-index: 2;
    }

    .company-logo {
      height: 80px;
      background: white;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      position: relative;
      overflow: hidden;
      padding: 12px;
      min-width: 200px;
    }

    .company-logo::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, #00A6FB 0%, #0582CA 100%);
      opacity: 0.05;
    }

    .logo-img {
      height: 100%;
      width: auto;
      max-width: 200px;
      object-fit: contain;
      position: relative;
      z-index: 2;
    }

    .header-text {
      text-align: center;
      flex: 1;
    }

    .header-text h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .header-text p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        gap: 20px;
      }

      .company-logo {
        height: 60px;
        min-width: 150px;
      }

      .header-text h1 {
        font-size: 1.8em;
      }
    }

    .form-container {
      padding: 40px;
    }

    .section {
      margin-bottom: 40px;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 30px;
      background: #fafafa;
    }

    .section-title {
      font-size: 1.5em;
      color: #1f2937;
      margin-bottom: 20px;
      font-weight: 600;
      border-bottom: 2px solid #00A6FB;
      padding-bottom: 10px;
    }

    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      font-weight: 500;
      color: #374151;
      margin-bottom: 8px;
    }

    .form-input, .form-select, .form-textarea {
      padding: 12px;
      border: 2px solid #d1d5db;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.2s;
    }

    .form-input:focus, .form-select:focus, .form-textarea:focus {
      outline: none;
      border-color: #00A6FB;
    }

    .form-textarea {
      min-height: 100px;
      resize: vertical;
    }

    .orcamento-card {
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      background: white;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .orcamento-card:hover {
      border-color: #00A6FB;
      box-shadow: 0 4px 12px rgba(0, 166, 251, 0.1);
    }

    .orcamento-card.selected {
      border-color: #00A6FB;
      background: #f0f9ff;
    }

    .orcamento-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .orcamento-empresa {
      font-size: 1.2em;
      font-weight: 600;
      color: #1f2937;
    }

    .orcamento-data {
      color: #6b7280;
      font-size: 0.9em;
    }

    .orcamento-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
    }

    .detail-item {
      display: flex;
      flex-direction: column;
    }

    .detail-label {
      font-size: 0.8em;
      color: #6b7280;
      text-transform: uppercase;
      font-weight: 500;
    }

    .detail-value {
      font-weight: 600;
      color: #1f2937;
    }

    .planos-selection {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .plano-card {
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 20px;
      background: white;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }

    .plano-card:hover {
      border-color: #00A6FB;
      transform: translateY(-2px);
    }

    .plano-card.selected {
      border-color: #00A6FB;
      background: #f0f9ff;
    }

    .plano-nome {
      font-size: 1.3em;
      font-weight: 700;
      color: #00A6FB;
      margin-bottom: 10px;
    }

    .plano-valor {
      font-size: 1.1em;
      color: #1f2937;
      margin-bottom: 15px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #00A6FB 0%, #0582CA 100%);
      color: white;
      border: none;
      padding: 20px 40px;
      font-size: 1.2em;
      border-radius: 12px;
      cursor: pointer;
      width: 100%;
      font-weight: 600;
      transition: transform 0.2s;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .contract-preview {
      display: none;
      margin-top: 40px;
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 30px;
    }

    .contract-header {
      text-align: center;
      margin-bottom: 30px;
      border-bottom: 2px solid #00A6FB;
      padding-bottom: 20px;
    }

    .contract-title {
      font-size: 1.8em;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 10px;
    }

    .contract-subtitle {
      color: #6b7280;
      font-size: 1.1em;
    }

    .contract-content {
      line-height: 1.8;
      font-size: 14px;
      color: #374151;
    }

    .contract-section {
      margin-bottom: 25px;
    }

    .contract-section h3 {
      color: #00A6FB;
      font-weight: 600;
      margin-bottom: 15px;
      font-size: 1.1em;
    }

    .contract-table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }

    .contract-table th,
    .contract-table td {
      padding: 10px;
      border: 1px solid #e5e7eb;
      text-align: left;
    }

    .contract-table th {
      background: #f8f9fa;
      font-weight: 600;
    }

    .actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 30px;
    }

    .action-btn {
      padding: 15px 25px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      font-size: 16px;
      position: relative;
      overflow: hidden;
      min-height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-download {
      background: #dc3545;
      color: white;
    }

    .btn-email {
      background: #28a745;
      color: white;
    }

    .btn-save {
      background: #6f42c1;
      color: white;
    }

    .action-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #6b7280;
    }

    @media (max-width: 768px) {
      .planos-selection {
        grid-template-columns: 1fr;
      }

      .orcamento-details {
        grid-template-columns: 1fr;
      }

      .actions {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-content">
        <div class="company-logo">
          <img src="https://ynembjipjkdycjacjudz.supabase.co/storage/v1/object/public/site/1%20-%20logotipo%203d/logo_horizontal_1920x1080.png" alt="LARtech Automation" class="logo-img">
        </div>
        <div class="header-text">
          <h1>Sistema de Contratos Internos</h1>
          <p>Ferramenta para gera√ß√£o de contratos personalizados</p>
        </div>
      </div>
    </div>

    <div class="form-container">
      <!-- Se√ß√£o 1: Sele√ß√£o do Or√ßamento -->
      <div class="section">
        <h2 class="section-title">1Ô∏è‚É£ Selecione o Or√ßamento</h2>
        <div id="orcamentos-list">
          <div class="empty-state">
            <h3>üìã Nenhum or√ßamento encontrado</h3>
            <p>Crie or√ßamentos no sistema interno para gerar contratos.</p>
            <a href="orcamento-interno.html" style="color: #00A6FB; text-decoration: none; font-weight: 600;">
              ‚ûï Ir para Sistema de Or√ßamentos
            </a>
          </div>
        </div>
      </div>

      <!-- Se√ß√£o 2: Sele√ß√£o do Plano -->
      <div class="section" id="planos-section" style="display: none;">
        <h2 class="section-title">2Ô∏è‚É£ Selecione o Plano Contratado</h2>
        <div class="planos-selection" id="planos-list">
          <!-- Planos ser√£o carregados dinamicamente -->
        </div>
      </div>

      <!-- Se√ß√£o 3: Informa√ß√µes Contratuais -->
      <div class="section" id="contrato-section" style="display: none;">
        <h2 class="section-title">3Ô∏è‚É£ Informa√ß√µes do Contrato</h2>
        <div class="form-row">
          <div class="form-group">
            <label for="data-inicio">Data de In√≠cio dos Servi√ßos *</label>
            <input type="date" id="data-inicio" class="form-input" required>
          </div>
          <div class="form-group">
            <label for="prazo-implementacao">Prazo de Implementa√ß√£o</label>
            <select id="prazo-implementacao" class="form-select">
              <option value="15-30 dias">15 a 30 dias</option>
              <option value="30-45 dias">30 a 45 dias</option>
              <option value="45-60 dias">45 a 60 dias</option>
              <option value="60-90 dias">60 a 90 dias</option>
              <option value="Personalizado">Personalizado</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="forma-pagamento">Forma de Pagamento</label>
            <select id="forma-pagamento" class="form-select">
              <option value="pix">PIX √† vista (5% desconto)</option>
              <option value="cartao">Cart√£o - at√© 3x sem juros</option>
              <option value="boleto">Boleto banc√°rio</option>
              <option value="transferencia">Transfer√™ncia banc√°ria</option>
            </select>
          </div>
          <div class="form-group">
            <label for="vigencia-contrato">Vig√™ncia do Contrato (meses)</label>
            <input type="number" id="vigencia-contrato" class="form-input" value="12" min="1">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="dia-cobranca">Dia de Cobran√ßa da Mensalidade</label>
            <select id="dia-cobranca" class="form-select">
              <option value="1">Todo dia 1</option>
              <option value="5" selected>Todo dia 5</option>
              <option value="10">Todo dia 10</option>
              <option value="15">Todo dia 15</option>
              <option value="20">Todo dia 20</option>
              <option value="25">Todo dia 25</option>
              <option value="30">Todo dia 30</option>
              <option value="data-inicio">Mesmo dia do in√≠cio dos servi√ßos</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label for="observacoes-contrato">Observa√ß√µes Especiais</label>
          <textarea id="observacoes-contrato" class="form-textarea" placeholder="Condi√ß√µes especiais, descontos acordados, etc."></textarea>
        </div>

        <button class="btn-primary" onclick="gerarContrato()">
          üìÑ Gerar Contrato de Presta√ß√£o de Servi√ßos
        </button>
      </div>

      <!-- Preview do Contrato -->
      <div class="contract-preview" id="contract-preview">
        <div class="contract-header">
          <div class="contract-title">CONTRATO DE PRESTA√á√ÉO DE SERVI√áOS</div>
          <div class="contract-subtitle">LARtech Automation - Solu√ß√µes de Automa√ß√£o Inteligente</div>
        </div>

        <div class="contract-content" id="contract-content">
          <!-- Conte√∫do ser√° gerado dinamicamente -->
        </div>

        <div class="actions">
          <button class="action-btn btn-download" onclick="baixarContrato()">üì• Baixar PDF</button>
          <button class="action-btn btn-email" onclick="enviarContrato()">üìß Enviar por Email</button>
          <button class="action-btn btn-save" onclick="salvarContrato()">üíæ Salvar Hist√≥rico</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let dadosOrcamento = null;
    let planoSelecionado = null;
    let orcamentoSelecionado = null;

    // Carregar or√ßamentos salvos
    function carregarOrcamentos() {
      const orcamentos = JSON.parse(localStorage.getItem('historico_orcamentos') || '[]');
      const container = document.getElementById('orcamentos-list');

      if (orcamentos.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <h3>üìã Nenhum or√ßamento encontrado</h3>
            <p>Crie or√ßamentos no sistema interno para gerar contratos.</p>
            <a href="orcamento-interno.html" style="color: #00A6FB; text-decoration: none; font-weight: 600;">
              ‚ûï Ir para Sistema de Or√ßamentos
            </a>
          </div>
        `;
        return;
      }

      container.innerHTML = orcamentos.map(orcamento => `
        <div class="orcamento-card" onclick="selecionarOrcamento(${orcamento.id})">
          <div class="orcamento-header">
            <div class="orcamento-empresa">${orcamento.empresa}</div>
            <div class="orcamento-data">${new Date(orcamento.data).toLocaleDateString('pt-BR')}</div>
          </div>
          <div class="orcamento-details">
            <div class="detail-item">
              <span class="detail-label">Contato</span>
              <span class="detail-value">${orcamento.contato}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Telefone</span>
              <span class="detail-value">${orcamento.telefone}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Email</span>
              <span class="detail-value">${orcamento.dados_completos?.email || orcamento.email || 'N√£o informado'}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">CNPJ/CPF</span>
              <span class="detail-value">${orcamento.dados_completos?.cnpj_cpf || 'N√£o informado'}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Plano Recomendado</span>
              <span class="detail-value">${orcamento.plano_recomendado.toUpperCase()}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Status</span>
              <span class="detail-value">${orcamento.status}</span>
            </div>
          </div>
        </div>
      `).join('');
    }

    function selecionarOrcamento(id) {
      const orcamentos = JSON.parse(localStorage.getItem('historico_orcamentos') || '[]');
      orcamentoSelecionado = orcamentos.find(o => o.id === id);

      if (!orcamentoSelecionado) return;

      // Marcar como selecionado
      document.querySelectorAll('.orcamento-card').forEach(card => {
        card.classList.remove('selected');
      });
      event.currentTarget.classList.add('selected');

      // Mostrar se√ß√£o de planos
      document.getElementById('planos-section').style.display = 'block';
      carregarPlanos();

      // Scroll suave para a pr√≥xima se√ß√£o
      document.getElementById('planos-section').scrollIntoView({ behavior: 'smooth' });
    }

    function carregarPlanos() {
      const planosContainer = document.getElementById('planos-list');

      // Configura√ß√£o dos planos com valores personalizados se dispon√≠veis
      const planos = {
        bronze: {
          nome: 'BRONZE',
          implementacao: orcamentoSelecionado.dados_completos?.bronze_implementacao || 4900,
          mensalidade: orcamentoSelecionado.dados_completos?.bronze_mensalidade || 490,
          recursos: [
            'Assistente Virtual B√°sica',
            'VPS B√°sica Dedicada',
            'Suporte via WhatsApp',
            'Base de conhecimento est√°tica'
          ]
        },
        prata: {
          nome: 'PRATA',
          implementacao: orcamentoSelecionado.dados_completos?.prata_implementacao || 7900,
          mensalidade: orcamentoSelecionado.dados_completos?.prata_mensalidade || 790,
          recursos: [
            'Assistente Virtual Avan√ßada',
            'Central Omnichannel B√°sica',
            'Dashboard de M√©tricas',
            'VPS Intermedi√°ria Dedicada',
            'Suporte Priorit√°rio'
          ]
        },
        ouro: {
          nome: 'OURO',
          implementacao: orcamentoSelecionado.dados_completos?.ouro_implementacao || 11900,
          mensalidade: orcamentoSelecionado.dados_completos?.ouro_mensalidade || 990,
          recursos: [
            'Assistente Virtual Premium com IA',
            'Central Omnichannel Completa',
            'Dashboard Avan√ßado Customizado',
            'Gest√£o Completa de CRM',
            'VPS Premium Dedicada',
            'Suporte Dedicado com Horas T√©cnicas'
          ]
        }
      };

      planosContainer.innerHTML = Object.entries(planos).map(([key, plano]) => `
        <div class="plano-card" onclick="selecionarPlano('${key}')">
          <div class="plano-nome">${plano.nome}</div>
          <div class="plano-valor">
            <strong>R$ ${plano.implementacao.toLocaleString('pt-BR')}</strong><br>
            + R$ ${plano.mensalidade.toLocaleString('pt-BR')}/m√™s
          </div>
          <div style="text-align: left; font-size: 0.9em; color: #6b7280;">
            ${plano.recursos.slice(0, 3).map(r => `‚Ä¢ ${r}`).join('<br>')}
            ${plano.recursos.length > 3 ? '<br>‚Ä¢ E muito mais...' : ''}
          </div>
        </div>
      `).join('');
    }

    function selecionarPlano(plano) {
      planoSelecionado = plano;

      // Marcar como selecionado
      document.querySelectorAll('.plano-card').forEach(card => {
        card.classList.remove('selected');
      });
      event.currentTarget.classList.add('selected');

      // Mostrar se√ß√£o do contrato
      document.getElementById('contrato-section').style.display = 'block';

      // Definir data de hoje como padr√£o
      document.getElementById('data-inicio').value = new Date().toISOString().split('T')[0];

      // Scroll suave para a pr√≥xima se√ß√£o
      document.getElementById('contrato-section').scrollIntoView({ behavior: 'smooth' });
    }

    function gerarContrato() {
      if (!orcamentoSelecionado || !planoSelecionado) {
        alert('Selecione um or√ßamento e um plano antes de gerar o contrato.');
        return;
      }

      const dadosContrato = coletarDadosContrato();
      const htmlContrato = gerarHtmlContrato(dadosContrato);

      document.getElementById('contract-content').innerHTML = htmlContrato;
      document.getElementById('contract-preview').style.display = 'block';

      // Scroll para o preview
      document.getElementById('contract-preview').scrollIntoView({ behavior: 'smooth' });

      // Salvar dados globalmente para as fun√ß√µes de a√ß√£o
      window.dadosContrato = dadosContrato;

      // Definir o atributo data-contract-number no elemento contract-content
      document.getElementById('contract-content').setAttribute('data-contract-number', dadosContrato.numeroContrato);
    }

    function coletarDadosContrato() {
      const planos = {
        bronze: { nome: 'BRONZE', implementacao: 4900, mensalidade: 490 },
        prata: { nome: 'PRATA', implementacao: 7900, mensalidade: 790 },
        ouro: { nome: 'OURO', implementacao: 11900, mensalidade: 990 }
      };

      // Usar valores personalizados se dispon√≠veis
      if (orcamentoSelecionado.dados_completos) {
        if (orcamentoSelecionado.dados_completos[`${planoSelecionado}_implementacao`]) {
          planos[planoSelecionado].implementacao = parseInt(orcamentoSelecionado.dados_completos[`${planoSelecionado}_implementacao`]);
        }
        if (orcamentoSelecionado.dados_completos[`${planoSelecionado}_mensalidade`]) {
          planos[planoSelecionado].mensalidade = parseInt(orcamentoSelecionado.dados_completos[`${planoSelecionado}_mensalidade`]);
        }
      }

      const plano = planos[planoSelecionado];
      const formaPagamento = document.getElementById('forma-pagamento').value;

      let valorFinal = plano.implementacao;
      if (formaPagamento === 'pix') {
        valorFinal = Math.round(plano.implementacao * 0.95); // 5% desconto
      }

      return {
        // Dados do cliente
        empresa: orcamentoSelecionado.empresa,
        contato: orcamentoSelecionado.contato,
        telefone: orcamentoSelecionado.telefone,
        email: orcamentoSelecionado.dados_completos?.email || orcamentoSelecionado.email || '',
        cnpj_cpf: orcamentoSelecionado.dados_completos?.cnpj_cpf || '',
        endereco: orcamentoSelecionado.dados_completos?.endereco || '',
        representante_legal: orcamentoSelecionado.dados_completos?.representante_legal || '',

        // Dados do plano
        plano: plano.nome,
        valorImplementacao: plano.implementacao,
        valorFinal: valorFinal,
        mensalidade: plano.mensalidade,

        // Dados contratuais
        dataInicio: document.getElementById('data-inicio').value,
        prazoImplementacao: document.getElementById('prazo-implementacao').value,
        formaPagamento: formaPagamento,
        vigenciaContrato: document.getElementById('vigencia-contrato').value,
        diaCobranca: document.getElementById('dia-cobranca').value,
        observacoes: document.getElementById('observacoes-contrato').value,

        // Dados do contrato
        numeroContrato: `LA-CONT-${Date.now().toString().slice(-6)}`,
        dataContrato: new Date().toLocaleDateString('pt-BR')
      };
    }

    function gerarHtmlContrato(dados) {
      const recursos = {
        bronze: [
          'Assistente Virtual Inteligente b√°sica',
          'VPS b√°sica dedicada (2 vCPU, 8GB RAM)',
          'Base de conhecimento est√°tica',
          'Suporte t√©cnico via WhatsApp'
        ],
        prata: [
          'Assistente Virtual Inteligente avan√ßada',
          'Central de Atendimento Unificada b√°sica',
          'Dashboard b√°sico de m√©tricas',
          'VPS intermedi√°ria dedicada (4 vCPU, 16GB RAM)',
          'Base de conhecimento din√¢mica (atualiza√ß√£o semanal)',
          'Suporte priorit√°rio'
        ],
        ouro: [
          'Assistente Virtual Premium com IA',
          'Central de Atendimento Unificada completa',
          'Dashboard avan√ßado customizado',
          'Gest√£o completa de CRM e leads',
          'VPS premium dedicada (8 vCPU, 32GB RAM)',
          'Base de conhecimento din√¢mica (atualiza√ß√£o di√°ria)',
          'Suporte dedicado com horas t√©cnicas',
          'Integra√ß√£o com API WhatsApp Business'
        ]
      };

      return `
        <div class="contract-section">
          <p><strong>Contrato N¬∫:</strong> ${dados.numeroContrato}</p>
          <p><strong>Data:</strong> ${dados.dataContrato}</p>
        </div>

        <div class="contract-section">
          <h3>QUALIFICA√á√ÉO DAS PARTES</h3>
          <p><strong>CONTRATADA:</strong> Lartech Servicos de Informatica LTDA, empresa especializada em solu√ß√µes de automa√ß√£o inteligente com IA, inscrita no CNPJ sob n¬∫ 59.632.001/0001-00, com sede na Rua Jose Alves de Almeida, 130, Conj 51 - Torre 1, Jardim Celeste, S√£o Paulo - SP, CEP 05527-080, representada por seu s√≥cio-administrador Lucas do Amaral Ribeiro.</p>

          <p><strong>CONTRATANTE:</strong> ${dados.empresa}, ${dados.cnpj_cpf ? `inscrita no CNPJ/CPF sob n¬∫ ${dados.cnpj_cpf}` : ''}, com sede/endere√ßo em ${dados.endereco || '[Endere√ßo a ser preenchido]'}${dados.representante_legal ? `, representada por ${dados.representante_legal}` : `, representada por ${dados.contato}`}, telefone: ${dados.telefone}, email: ${dados.email}.</p>
        </div>

        <div class="contract-section">
          <h3>OBJETO DO CONTRATO</h3>
          <p>A CONTRATADA obriga-se a prestar os seguintes servi√ßos de automa√ß√£o inteligente:</p>

          <p><strong>Plano Contratado:</strong> ${dados.plano}</p>

          <h4>Servi√ßos Inclusos:</h4>
          <ul>
            ${recursos[dados.plano.toLowerCase()].map(recurso => `<li>${recurso}</li>`).join('')}
          </ul>
        </div>

        <div class="contract-section">
          <h3>VALORES E FORMA DE PAGAMENTO</h3>
          <table class="contract-table">
            <tr>
              <th>Descri√ß√£o</th>
              <th>Valor</th>
            </tr>
            <tr>
              <td>Implementa√ß√£o e Configura√ß√£o${dados.formaPagamento === 'pix' ? ' (com 5% desconto PIX)' : ''}</td>
              <td>R$ ${dados.valorFinal.toLocaleString('pt-BR')}</td>
            </tr>
            <tr>
              <td>Mensalidade dos Servi√ßos</td>
              <td>R$ ${dados.mensalidade.toLocaleString('pt-BR')}</td>
            </tr>
          </table>

          <p><strong>Forma de Pagamento da Implementa√ß√£o:</strong> ${getFormaPagamentoTexto(dados.formaPagamento)}</p>
          <p><strong>Cobran√ßa Mensal:</strong> ${getDiaCobrancaTexto(dados.diaCobranca, dados.dataInicio)}, via boletobanc√°rio ou d√©bito autom√°tico.</p>
        </div>

        <div class="contract-section">
          <h3>PRAZO DE IMPLEMENTA√á√ÉO</h3>
          <p>A implementa√ß√£o completa dos servi√ßos ser√° realizada no prazo de <strong>${dados.prazoImplementacao}</strong>, contados a partir da data de in√≠cio: <strong>${new Date(dados.dataInicio).toLocaleDateString('pt-BR')}</strong>.</p>
        </div>

        <div class="contract-section">
          <h3>VIG√äNCIA</h3>
          <p>Este contrato ter√° vig√™ncia de <strong>${dados.vigenciaContrato} meses</strong>, iniciando em ${new Date(dados.dataInicio).toLocaleDateString('pt-BR')}, renov√°vel automaticamente por per√≠odos iguais, salvo manifesta√ß√£o contr√°ria de qualquer das partes com anteced√™ncia m√≠nima de 30 dias.</p>
        </div>

        <div class="contract-section">
          <h3>OBRIGA√á√ïES DA CONTRATADA</h3>
          <ul>
            <li>Implementar e configurar todos os sistemas conforme especificado no plano contratado;</li>
            <li>Fornecer treinamento completo √† equipe do CONTRATANTE;</li>
            <li>Garantir suporte t√©cnico conforme o plano contratado;</li>
            <li>Realizar backup di√°rio dos dados e configura√ß√µes;</li>
            <li>Manter sigilo absoluto sobre todas as informa√ß√µes do CONTRATANTE.</li>
          </ul>
        </div>

        <div class="contract-section">
          <h3>OBRIGA√á√ïES DO CONTRATANTE</h3>
          <ul>
            <li>Efetuar os pagamentos nas datas acordadas;</li>
            <li>Fornecer todas as informa√ß√µes necess√°rias para implementa√ß√£o;</li>
            <li>Participar dos treinamentos e reuni√µes de alinhamento;</li>
            <li>Comunicar imediatamente qualquer problema ou dificuldade;</li>
            <li>Manter atualizadas as informa√ß√µes de contato e dados da empresa.</li>
          </ul>
        </div>

        <div class="contract-section">
          <h3>GARANTIAS</h3>
          <p>A CONTRATADA garante que todos os servi√ßos ser√£o executados conforme as especifica√ß√µes t√©cnicas acordadas. Problemas t√©cnicos ser√£o corrigidos sem custo adicional durante todo o per√≠odo de vig√™ncia do contrato.</p>
        </div>

        <div class="contract-section">
          <h3>RESCIS√ÉO</h3>
          <p>O contrato poder√° ser rescindido por qualquer das partes mediante aviso pr√©vio de 30 dias. Em caso de rescis√£o pelo CONTRATANTE antes do prazo m√≠nimo de 12 meses, ser√° aplicada multa de 30% sobre o valor das mensalidades restantes.</p>
        </div>

        ${dados.observacoes ? `
        <div class="contract-section">
          <h3>OBSERVA√á√ïES ESPECIAIS</h3>
          <p>${dados.observacoes}</p>
        </div>
        ` : ''}

        <div class="contract-section" style="margin-top: 40px;">
          <p>E, por estarem assim justos e contratados, firmam o presente instrumento em duas vias de igual teor.</p>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-top: 60px;">
            <div style="text-align: center; border-top: 1px solid #000; padding-top: 10px;">
              <strong>CONTRATADA</strong><br>
              Lartech Servicos de Informatica LTDA<br>
              Lucas do Amaral Ribeiro
            </div>
            <div style="text-align: center; border-top: 1px solid #000; padding-top: 10px;">
              <strong>CONTRATANTE</strong><br>
              ${dados.empresa}<br>
              ${dados.contato}
            </div>
          </div>
        </div>
      `;
    }

    function getFormaPagamentoTexto(forma) {
      const formas = {
        'pix': 'PIX √† vista com 5% de desconto',
        'cartao': 'Cart√£o de cr√©dito em at√© 3x sem juros',
        'boleto': 'Boleto banc√°rio √† vista',
        'transferencia': 'Transfer√™ncia banc√°ria √† vista'
      };
      return formas[forma] || forma;
    }

    function getDiaCobrancaTexto(diaCobranca, dataInicio) {
      if (diaCobranca === 'data-inicio') {
        const diaInicio = new Date(dataInicio).getDate();
        return `Todo dia ${diaInicio} de cada m√™s`;
      } else {
        return `Todo dia ${diaCobranca} de cada m√™s`;
      }
    }


function baixarContrato() {
      if (!window.dadosContrato) {
        alert('Erro: Dados do contrato n√£o encontrados. Gere o contrato novamente.');
        return;
      }

      // Criar uma nova janela com apenas o conte√∫do do contrato
      const contratoContent = document.getElementById('contract-content').innerHTML;
      const contratoNumber = window.dadosContrato.numeroContrato;
      const empresaNome = window.dadosContrato.empresa.replace(/[^a-zA-Z0-9]/g, '_');

      const printWindow = window.open('', '_blank');
      printWindow.document.write(`
        <!DOCTYPE html>
        <html lang="pt-br">
        <head>
          <meta charset="UTF-8">
          <title>Contrato_${contratoNumber}_${empresaNome}</title>
          <style>
            * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
              -webkit-print-color-adjust: exact !important;
              color-adjust: exact !important;
            }

            body {
              font-family: 'Inter', Arial, sans-serif;
              color: #2A2D34;
              line-height: 1.6;
              background: white;
              font-size: 11pt;
            }

            .contract-header {
              background: linear-gradient(135deg, #00A6FB 0%, #0582CA 100%);
              color: white;
              padding: 30pt;
              text-align: center;
              page-break-inside: avoid;
              position: relative;
              overflow: hidden;
              margin-bottom: 20pt;
            }

            .contract-title {
              font-size: 22pt;
              font-weight: 700;
              margin-bottom: 8pt;
              text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
              letter-spacing: 0.5pt;
              text-decoration: none !important;
            }

            .contract-subtitle {
              font-size: 14pt;
              opacity: 0.95;
              font-weight: 500;
            }

            .contract-content {
              padding: 20pt;
              line-height: 1.5;
            }

            .contract-section {
              margin-bottom: 15pt;
              page-break-inside: avoid;
            }

            .contract-section h3 {
              color: #00A6FB;
              font-size: 13pt;
              font-weight: 700;
              margin-bottom: 8pt;
              border-bottom: 2px solid #00A6FB;
              padding-bottom: 4pt;
              text-transform: uppercase;
              letter-spacing: 0.3pt;
            }

            .contract-section p {
              margin-bottom: 8pt;
              text-align: justify;
            }

            .contract-section ul {
              margin: 8pt 0;
              padding-left: 18pt;
            }

            .contract-section li {
              margin-bottom: 4pt;
            }

            .contract-table {
              width: 100%;
              border-collapse: collapse;
              margin: 12pt 0;
              font-size: 10pt;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
              border-radius: 6pt;
              overflow: hidden;
            }

            .contract-table th,
            .contract-table td {
              padding: 10pt 12pt;
              border: 1px solid #e5e7eb;
              text-align: left;
            }

            .contract-table th {
              background: linear-gradient(135deg, #00A6FB 0%, #0582CA 100%);
              color: white;
              font-weight: 600;
              text-transform: uppercase;
              letter-spacing: 0.3pt;
            }

            .contract-table td {
              background: white;
            }

            .contract-table tr:nth-child(even) td {
              background: #f8f9fa;
            }

            h4 {
              font-size: 11pt;
              font-weight: 600;
              margin: 10pt 0 6pt 0;
              color: #00A6FB;
            }

            @page {
              margin: 15mm;
              @bottom-center {
                content: "LARtech Automation - Contrato ${contratoNumber} - P√°gina " counter(page);
                font-size: 8pt;
                color: #6c757d;
                font-family: 'Inter', Arial, sans-serif;
              }
            }

            @media print {
              body { 
                font-size: 11pt; 
              }

              .contract-section:last-child {
                page-break-inside: avoid;
                margin-top: 30pt;
              }

              .contract-section:last-child > div:last-child {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 40pt;
                margin-top: 40pt;
              }

              .contract-section:last-child > div:last-child > div {
                text-align: center;
                border-top: 2px solid #00A6FB;
                padding-top: 8pt;
                font-weight: 600;
              }
            }
          </style>
        </head>
        <body>
          <div class="contract-header">
            <div class="contract-title">CONTRATO DE PRESTA√á√ÉO DE SERVI√áOS</div>
            <div class="contract-subtitle">LARtech Automation - Solu√ß√µes de Automa√ß√£o Inteligente</div>
          </div>

          <div class="contract-content">
            ${contratoContent}
          </div>
        </body>
        </html>
      `);

      printWindow.document.close();

      // Aguardar carregamento e imprimir
      printWindow.onload = function() {
        setTimeout(() => {
          printWindow.print();
          printWindow.close();
        }, 500);
      };
    }

    function enviarContrato() {
      const dados = window.dadosContrato;
      if (!dados.email) {
        alert('Email do cliente n√£o informado no or√ßamento.');
        return;
      }

      const assunto = `Contrato de Presta√ß√£o de Servi√ßos ${dados.numeroContrato} - ${dados.empresa}`;
      const corpo = `Prezado(a) ${dados.contato},

Conforme acordado, segue o contrato de presta√ß√£o de servi√ßos para implementa√ß√£o do plano ${dados.plano}.

RESUMO DO CONTRATO:
‚Ä¢ Contrato: ${dados.numeroContrato}
‚Ä¢ Plano: ${dados.plano}
‚Ä¢ Valor de Implementa√ß√£o: R$ ${dados.valorFinal.toLocaleString('pt-BR')}
‚Ä¢ Mensalidade: R$ ${dados.mensalidade.toLocaleString('pt-BR')}
‚Ä¢ Data de In√≠cio: ${new Date(dados.dataInicio).toLocaleDateString('pt-BR')}
‚Ä¢ Vig√™ncia: ${dados.vigenciaContrato} meses

Por favor, revise o contrato e, em caso de concord√¢ncia, assine e devolva para iniciarmos a implementa√ß√£o.

Para visualizar o contrato completo, acesse: ${window.location.href}

Estamos √† disposi√ß√£o para esclarecer quaisquer d√∫vidas.

Atenciosamente,
LARtech Automation
üì± WhatsApp: (11) 99902-7653
‚úâÔ∏è lucas.ribeiro@lartechautomation.com`;

      window.location.href = `mailto:${dados.email}?subject=${encodeURIComponent(assunto)}&body=${encodeURIComponent(corpo)}`;
    }

    function salvarContrato() {
      const dados = window.dadosContrato;
      const contratos = JSON.parse(localStorage.getItem('historico_contratos') || '[]');

      const novoContrato = {
        id: Date.now(),
        numero: dados.numeroContrato,
        data_criacao: new Date().toISOString(),
        orcamento_id: orcamentoSelecionado.id,
        empresa: dados.empresa,
        contato: dados.contato,
        plano: dados.plano,
        valor_implementacao: dados.valorFinal,
        valor_mensal: dados.mensalidade,
        data_inicio: dados.dataInicio,
        vigencia: dados.vigenciaContrato,
        status: 'Gerado',
        dados_completos: dados
      };

      contratos.push(novoContrato);
      localStorage.setItem('historico_contratos', JSON.stringify(contratos));

      alert('‚úÖ Contrato salvo no hist√≥rico com sucesso!');
    }

    // Carregar or√ßamentos ao inicializar
    window.addEventListener('load', function() {
      carregarOrcamentos();

      // Verificar se h√° um or√ßamento pr√©-selecionado
      const orcamentoPreSelecionado = localStorage.getItem('orcamento_selecionado_contrato');
      if (orcamentoPreSelecionado) {
        localStorage.removeItem('orcamento_selecionado_contrato');

        // Aguardar um momento para garantir que os or√ßamentos foram carregados
        setTimeout(() => {
          const orcamentoCard = document.querySelector(`[onclick="selecionarOrcamento(${orcamentoPreSelecionado})"]`);
          if (orcamentoCard) {
            orcamentoCard.click();
          }
        }, 100);
      }
    });


// Adicionar estilos espec√≠ficos para PDF com arte gr√°fica da LARtech
      const pdfStyles = document.createElement('style');
      pdfStyles.id = 'pdf-styles';
      pdfStyles.innerHTML = `
        @media print {
          * {
            -webkit-print-color-adjust: exact !important;
            color-adjust: exact !important;
          }

          body {
            font-family: 'Inter', Arial, sans-serif;
            color: #2A2D34;
            line-height: 1.6;
            max-width: 100%;
            margin: 0;
            padding: 0;
            background: white;
          }

          /* Ocultar completamente a interface do sistema */
          .container > *:not(.contract-preview) {
            display: none !important;
          }

          .contract-preview {
            display: block !important;
            margin: 0;
            padding: 0;
            background: white;
            border: none;
            border-radius: 0;
            box-shadow: none;
            width: 100%;
            max-width: none;
          }

          .contract-header {
            background: linear-gradient(135deg, #00A6FB 0%, #0582CA 100%);
            color: white;
            padding: 30pt;
            margin: 0;
            text-align: center;
            page-break-inside: avoid;
            position: relative;
            overflow: hidden;
          }

          .contract-title {
            font-size: 22pt;
            font-weight: 700;
            margin-bottom: 8pt;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            letter-spacing: 0.5pt;
          }

          .contract-subtitle {
            font-size: 14pt;
            opacity: 0.95;
            font-weight: 500;
          }

          .contract-content {
            font-size: 11pt;
            line-height: 1.5;
            color: #2A2D34;
            padding: 25pt;
          }

          .contract-section {
            margin-bottom: 15pt;
            page-break-inside: avoid;
          }

          .contract-section h3 {
            color: #00A6FB;
            font-size: 13pt;
            font-weight: 700;
            margin-bottom: 8pt;
            border-bottom: 2px solid #00A6FB;
            padding-bottom: 4pt;
            text-transform: uppercase;
            letter-spacing: 0.3pt;
          }

          .contract-section p {
            margin-bottom: 8pt;
            text-align: justify;
          }

          .contract-section ul {
            margin: 8pt 0;
            padding-left: 18pt;
          }

          .contract-section li {
            margin-bottom: 4pt;
          }

          .contract-table {
            width: 100%;
            border-collapse: collapse;
            margin: 12pt 0;
            font-size: 10pt;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-radius: 6pt;
            overflow: hidden;
          }

          .contract-table th,
          .contract-table td {
            padding: 10pt 12pt;
            border: 1px solid #e5e7eb;
            text-align: left;
          }

          .contract-table th {
            background: linear-gradient(135deg, #00A6FB 0%, #0582CA 100%);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3pt;
          }

          .contract-table td {
            background: white;
          }

          .contract-table tr:nth-child(even) td {
            background: #f8f9fa;
          }

          /* Assinaturas sempre juntas */
          .contract-section:last-child {
            page-break-inside: avoid;
            margin-top: 30pt;
          }

          .contract-section:last-child > div:last-child {
            border-top: none;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40pt;
            margin-top: 40pt;
          }

          .contract-section:last-child > div:last-child > div {
            text-align: center;
            border-top: 2px solid #00A6FB;
            padding-top: 8pt;
            font-weight: 600;
          }

          h4 {
            font-size: 11pt;
            font-weight: 600;
            margin: 10pt 0 6pt 0;
            color: #00A6FB;
          }

          /* Rodap√© com marca d'√°gua */
          @page {
            margin: 15mm;
            @bottom-center {
              content: "LARtech Automation - Contrato " attr(data-contract-number) " - P√°gina " counter(page);
              font-size: 8pt;
              color: #6c757d;
              font-family: 'Inter', Arial, sans-serif;
            }
          }

          /* Marca d'√°gua sutil */
          .contract-content::before {
            content: '';
            position: fixed;
            top: 50%;
            left: 50%;
            width: 300px;
            height: 300px;
            background: url('https://ynembjipjkdycjacjudz.supabase.co/storage/v1/object/public/site/1%20-%20logotipo%203d/logotipo_vt_1200x1200.png') no-repeat center;
            background-size: contain;
            opacity: 0.03;
            transform: translate(-50%, -50%);
            z-index: -1;
            pointer-events: none;
          }

          /* Ocultar elementos n√£o necess√°rios */
          .actions,
          .form-container,
          .header,
          nav,
          .mobile-menu-button,
          .whatsapp-float,
          .container > .header,
          .container > .form-container {
            display: none !important;
          }
        }
      `;
      document.head.appendChild(pdfStyles);
  </script>
</body>
</html>